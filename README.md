 
  <body>
    <h1>iMessage Chatbot</h1>
    <h2>Description</h2>
    <p>
      This is a Python script that creates an iMessage chatbot using OpenAI's
      chat completion model. The chatbot automatically sends responses to
      incoming messages on iMessage based on the conversation history and the
      available data sources.
    </p>
    <h2>Requirements</h2>
    <ul>
      <li>Python 3</li>
      <li>sqlite3</li>
      <li>OpenAI API key</li>
      <li>Apple ID associated with iMessage</li>
    </ul>
    <h2>Setup</h2>
    <h3>Install Required Libraries</h3>
    <p>
      Install the required libraries by running
      <code>pip3 install -r requirements.txt</code>.
    </p>
    <h3>Add OpenAI API Key</h3>
    <p>
      Add your OpenAI API key in the line
      <code>openai.api_key = "Your API key"</code>.
    </p>
    <h3>Set Contact Phone Number</h3>
    <p>
      Replace the value of the <code>contact_handle</code> variable with the
      phone number you want the bot to interact with.
    </p>
    <h3>Set Apple ID Email Address</h3>
    <p>
      Replace the value of the <code>phone_to_email</code> dictionary with the
      email address associated with your Apple ID.
    </p>
    <h3>Customize Response Files</h3>
    <p>
      Customize the <code>standard_responses.json</code> and
      <code>system_messages.json</code> files to add your own responses and
      system messages.
    </p>
    <h3>System Messages</h3>
    <p>A system message in the context of a <code>chat.completion</code> model from OpenAI refers to a message that is generated by the system or bot participating in the conversation, as opposed to a message that is sent by the user.</p>
    <p>System messages are included in the <code>messages</code> parameter of the <code>openai.ChatCompletion.create()</code> function call, which sends a prompt to the GPT-3 language model and receives a response. The <code>messages</code> parameter is a list of dictionaries, where each dictionary represents a message with two keys: <code>role</code> and <code>content</code>. The <code>role</code> key indicates whether the message is from the user or the assistant (system/bot), and the <code>content</code> key contains the actual text of the message.</p>
    <p>System messages are important because they help to provide context and information to the GPT-3 language model, which can then generate more accurate and relevant responses. For example, system messages might include information about the conversation history, the user's previous messages, or other contextual information that might be relevant to the prompt.</p>
    <h3>Standard Responses</h3>
    <p>Standard responses are pre-written messages that the chatbot can use to respond to user queries. These responses are stored in a JSON file and loaded into the program. When a user sends a message, the chatbot checks if the message matches any of the pre-defined patterns in the JSON file. If a match is found, the chatbot returns the corresponding response.</p>
    <p>Standard responses can help reduce response time and improve the user experience by providing quick and accurate answers to common questions. It is important to update the JSON file regularly to ensure that the chatbot's responses remain relevant and helpful to users.</p>
    <p>In the code provided, the standard responses are stored in a dictionary and are checked against the user's input using the `check_for_matching_message` function. The minimum similarity score needed to match a received message to one of the standard responses can be adjusted by changing the threshold value in the `if similarity >= 0.65` line.</p>
    <p>When a match is found, the chatbot selects a random response from the list of responses associated with the matched pattern. If no match is found, the chatbot sends the user's message to the OpenAI GPT-3 language model to generate a response.</p>
    <h3>Run the Script</h3>
    <p>Run the script using <code>python3 chatbot.py</code>.</p>
    <h2>Usage</h2>
    <p>
      The chatbot will automatically send responses to incoming messages on
      iMessage based on the conversation history and the available data sources.
      You can customize the behavior of the chatbot by modifying the
      <code>get_openai_response</code> function and the data sources used by the
      script.
    </p>
    <h2>Troubleshooting</h2>
    <p>
      If you encounter any issues while running the script, you can try the
      following:
    </p>
    <ul>
      <li>
        Check that your OpenAI API key is valid and has sufficient permissions.
      </li>
      <li>
        Check that your Apple ID is associated with the iMessage account you
        want to use.
      </li>
      <li>
        Check that the <code>chat.db</code> file path in the <code>conn</code>
        variable is correct for your system.
      </li>
      <li>
        Check that the <code>standard_responses.json</code> and
        <code>system_messages.json</code> files are properly formatted and
        contain valid data.
      </li>
    </ul>
    <h2>Credits</h2>
    <p>
      This script was created by Fredrik Haugen. If you have any questions or feedback, please contact me at fredrik@haugendesign.net.
    <p>
    </body>
